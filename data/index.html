<div id="set" class="modal">
    <div class="modal-content">
        <h2>Systeminnstillinger</h2>
        <label>MQTT Broker IP (Home Assistant):</label>
        <input type="text" id="mqtt_host" placeholder="f.eks. 192.168.1.50">
        <label>Port:</label>
        <input type="number" id="mqtt_port" value="1883">
        
        <div style="margin-top:20px; display:flex; gap:10px;">
            <button class="btn" onclick="saveSettings()">LAGRE & RESTART</button>
            <button class="btn" style="background:#65676b;" onclick="document.getElementById('set').style.display='none'">AVBRYT</button>
        </div>
    </div>
</div>

<script>
    // Hent nåværende config når modal åpnes
    function openSettings() {
        fetch('/api/get_config')
            .then(r => r.json())
            .then(d => {
                document.getElementById('mqtt_host').value = d.mqtt_host;
                document.getElementById('mqtt_port').value = d.mqtt_port;
                document.getElementById('set').style.display = 'block';
            });
    }

    // Send ny config til ESP32
    function saveSettings() {
        const data = {
            mqtt_host: document.getElementById('mqtt_host').value,
            mqtt_port: parseInt(document.getElementById('mqtt_port').value)
        };
        fetch('/api/save_config', {
            method: 'POST',
            body: JSON.stringify(data)
        }).then(() => {
            alert("Innstillinger lagret. Enheten restarter...");
            location.reload();
        });
    }
</script>
